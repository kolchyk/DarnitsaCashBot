#!/bin/bash
# Post-compile hook for Heroku to install Playwright browser
set -e  # Exit on error

echo "-----> Installing Playwright Chromium browser..."

# Set Playwright environment variables to ensure correct installation path
export PLAYWRIGHT_BROWSERS_PATH=/app/.cache/ms-playwright

# Install chromium with headless_shell variant (required for Heroku)
# This installs to /app/.cache/ms-playwright/ which is where Playwright expects it
python -m playwright install chromium

# Also install chromium-headless-shell if available (newer Playwright versions)
python -m playwright install chromium-headless-shell || echo "-----> chromium-headless-shell not available, using chromium"

# Verify installation
if [ -d "/app/.cache/ms-playwright" ]; then
    echo "-----> Playwright browsers installed to /app/.cache/ms-playwright/"
    echo "-----> Browser directory contents:"
    find /app/.cache/ms-playwright -type f -name "*headless*" -o -name "*chromium*" | head -20 || true
    echo "-----> Total size:"
    du -sh /app/.cache/ms-playwright || true
else
    echo "-----> WARNING: Playwright browsers directory not found at expected location"
    echo "-----> Attempting to create directory and reinstall..."
    mkdir -p /app/.cache/ms-playwright
    python -m playwright install chromium
fi

echo "-----> Playwright Chromium installed successfully!"

